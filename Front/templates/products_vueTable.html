<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet"> -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"> -->


    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card {
            margin-bottom: 20px;
        }
        .card img {
            height: 200px;
            object-fit: cover;
        }
        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .details {
            font-size: 0.9rem;
        }
        .lot-info {
            font-size: 0.85rem;
            color: gray;
        }
        .price {
            font-weight: bold;
            font-size: 1rem;
            color: #007bff;
        }
    </style>



    
</head>

<body> 
<!-- style="border: 2px solid green;""> -->

    <!-- <div  -->
        <!-- style="border: 2px solid goldenrod;"  -->
        <!-- class="container-fluid"> -->
    <!-- class="container col-3 mt-4 mx-4"> -->

    <!-- <div class="container mt-4"> -->
    <!-- <div class="col-12 col-sm-6 col-md-3 col-lg-3"> -->
        <h1 class="container mt-4">
            Лоты продажи {{ sale.id_number }} ({{ sale.room }}) — 
            <!-- <span id="lot-count">0</span> лотов -->
            <!-- Добавляем блок для подсчета карточек -->
            <!-- <div class="mt-3"> -->
                <span id="card-count">Init ...</span>
            <!-- </div> -->
            <!-- <button type="button" class="btn btn-secondary ml-2" id="reset-filters">Сбросить фильтры</button> -->
        </h1>

        <div class="container mt-6">
            <form id="filter-form" class="row g-3">
                <div class="col-md-3">
                    <!-- <label for="name" class="form-label">Марка</label> -->
                    <input type="text" class="form-control" id="name" name="name" placeholder="Введите марку">
                </div>
                <div class="col-md-3">
                    <!-- <label for="model" class="form-label">Зал</label> -->
                    <input type="text" class="form-control" id="model" name="model" placeholder="model">
                </div>
                <div class="col-md-3">
                    <!-- <label for="mileage" class="form-label">Пробег</label> -->
                    <input type="number" class="form-control" id="mileage" name="mileage" placeholder="Пробег">
                </div>
                <div class="col-md-3">
                    <!-- <label for="price" class="form-label">Цена</label> -->
                    <input type="number" class="form-control" id="price" name="price" placeholder="Максимальная цена">
                </div>
                <!-- <div class="col-md-3"> -->
                    <!-- <button type="submit" class="btn btn-primary">Применить фильтры</button> -->
                    <!-- <button type="reset" class="btn btn-secondary">Сбросить</button> -->
                <!-- </div> -->

                <!-- Существующие фильтры -->
                <!-- <div class="col-md-3">
                    <label for="name" class="form-label">Марка</label>
                    <input type="text" class="form-control" id="name" name="name" placeholder="Введите марку">
                </div>
                <div class="col-md-3">
                    <label for="mileage" class="form-label">Пробег</label>
                    <input type="number" class="form-control" id="mileage" name="mileage" placeholder="Пробег">
                </div>
                <div class="col-md-3">
                    <label for="price" class="form-label">Цена</label>
                    <input type="number" class="form-control" id="price" name="price" placeholder="Максимальная цена">
                </div>
                <div class="col-md-3">
                    <label for="model" class="form-label">Модель</label>
                    <input type="text" class="form-control" id="model" name="model" placeholder="Введите модель">
                </div> -->

                <!-- Новые фильтры -->
                <div class="col-md-3">
                    <!-- <label for="energy" class="form-label">Энергия</label> -->
                    <input type="text" class="form-control" id="energy" name="energy" placeholder="Введите тип энергии">
                </div>
                <div class="col-md-3">
                    <!-- <label for="gearbox" class="form-label">Коробка</label> -->
                    <input type="text" class="form-control" id="gearbox" name="gearbox" placeholder="Введите тип коробки">
                </div>
                <div class="col-md-3">
                    <!-- <label for="type" class="form-label">Тип</label> -->
                    <input type="text" class="form-control" id="type" name="type" placeholder="Введите тип">
                </div>
                <div class="col-md-3">
                    <label for="mileage_count" class="form-check-label">Повторная продажа: </label>
                    <input type="checkbox" class="form-check-input" id="mileage_count" name="mileage_count">
                </div>

                <!-- Кнопки -->
                <div class="col-md-13">
                    <!-- <button type="submit" class="btn btn-primary">Применить фильтры</button> -->
                    <button type="reset" class="btn btn-secondary">Сбросить</button>
                </div>
            </form>
        </div>
        

        <div 
        
        class="row card-container mx-5 mt-4">
        <!-- style="border: 2px solid blueviolet;"           -->
        <!-- style="display: flex; flex-wrap: wrap;" -->

            {% for product in products %}
            <!-- <div> -->
            <div 
            class="col-12 col-md-4 col-lg-3 col-xl-2">
            <!-- style="border: 2px solid orangered" -->
                <!-- xs (extra small, <576px): контейнер занимает 100% ширины. -->
                <!-- sm (small, ≥576px): фиксированная ширина 540px. -->
                <!-- md (medium, ≥768px): фиксированная ширина 720px. -->
                <!-- lg (large, ≥992px): фиксированная ширина 960px. -->
                <!-- xl (extra large, ≥1200px): фиксированная ширина 1140px. -->

                <!-- class="col-md-2"> -->
            <!-- <div class="col-md-4"> -->
            <!-- <div class="col-12 col-sm-6 col-md-2 col-lg-2"> -->

                <div class="card"
                    data-name="{{ product.name }}"
                    data-model="{{ product.model }}"
                    data-mileage="{{ product.mileage }}"
                    data-energy="{{ product.energy }}"
                    data-rollout="{{ product.rollout }}"
                    data-gearbox="{{ product.gearbox }}"
                    data-decision="{{ product.decision }}"
                    data-openingBid="{{ product.openingBid }}"
                    data-highestBidValue="{{ product.highestBidValue }}"
                    data-mileage_count="{{ product.mileage_count }}"
                >
                    <a href="#" class="lot-link" data-lot-id="{{ product.lotId }}">
                        <img src="{{ product.mainImgUrl }}" class="card-img-top" alt="{{ product.name }}">
                        <!-- <img src="{{ product.mainImgUrl }}" class="card-img-top" style="width: 250px;" alt="{{ product.name }}"> -->
                    </a>
                    <!-- <img src="{{ product.mainImgUrl }}" class="card-img-top" alt="{{ product.name }}"> -->
                    <div class="card-body">
                        <h3 class="card-title">{{ product.name }}</h3>
                        <h5 class="card-title">{{ product.model }}</h5>
                        <p class="details">
                            Énergie: {{ product.energy }} <br>
                            <a href="#" class="mileage-link" data-lot-id="{{ product.mileage }}">{{ product.mileage }}</a> <br>
                            1ère mise: {{ product.rollout }} <br>
                            Boîte: {{ product.gearbox }}
                        </p>
                        <p class="lot-info">
                            Lot №: <strong>{{ product.lotNumber }}</strong> 
                            {% if product.decision == 'DECISION_REMOVED' %}
                                <i class="fas fa-times-circle text-danger" title="Удалено"></i>
                            {% elif product.decision == 'DECISION_SOLD' %}
                                <i class="fas fa-check-circle text-success" title="Продано"></i>
                            {% else %}
                                <i class="fas fa-question-circle text-warning" title="Неизвестно"></i>
                            {% endif %}
                            <!-- Salle: {{ product.room }} <br> -->
                            <!-- Date vente: {{ product.date }} -->
                            {{ product.mileage_count }}
                        </p>
                        <p class="price">Mise à prix: {{ product.openingBid }} €
                            -> {{ product.highestBidValue }}
                            <!-- {% if product.decision == 'DECISION_SOLD' %} -->
                            <!-- {% endif %} -->
                        </p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    <!-- </div> -->



<div class="container">
    <h1 class="mt-4">Лоты продажи {{ sale.id_number }} ({{ sale.seller_name }}) — <span id="lot-count">0</span> лотов
    <button type="button" class="btn btn-secondary ml-2" id="reset-filters">Сбросить фильтры</button>
    </h1>

    <!-- <form class="mb-3">
        <div class="form-row">
            <input type="text" class="form-control filter-input" placeholder="Фильтр по модели" data-field="model">
            <input type="text" class="form-control filter-input" placeholder="Фильтр по названию" data-field="name">
            <input type="text" class="form-control filter-input" placeholder="Фильтр по топливу" data-field="energy">
            <input type="text" class="form-control filter-input" placeholder="Фильтр по коробке передач" data-field="gearbox">
            <input type="text" class="form-control filter-input" placeholder="Фильтр по типу" data-field="type">
            <input type="text" class="form-control filter-input" placeholder="Фильтр по решению" data-field="decision">
            <button type="button" class="btn btn-secondary ml-2" id="reset-filters">Сбросить фильтры</button>
        </div>
    </form> -->



    <table class="table table-striped">
        <thead>
            <!-- <tr>
                <th>Модель</th>
                <th>Название</th>
                <th>Фото</th>
                <th>Топливо</th>
                <th>Коробка</th>
                <th>Активен</th>
                <th>Тип</th>
                <th>Решение</th>
            </tr> -->
            <tr>
                <!-- Поля фильтров расположены под заголовками колонок -->
                
                <th><input type="text" class="form-control filter-input" placeholder="Лот" data-field="lotNumber"></th>
                <th><input type="text" class="form-control filter-input" placeholder="Модель" data-field="model"></th>
                <th><input type="text" class="form-control filter-input" placeholder="Название" data-field="name"></th>
                <th></th> <!-- Нет фильтра для колонки с фото -->
                <th></th> <!-- Нет фильтра для колонки с километражом -->
                <th><input type="text" class="form-control filter-input" placeholder="Топливо" data-field="energy"></th>
                <th><input type="text" class="form-control filter-input" placeholder="Коробка" data-field="gearbox"></th>
                <th></th> <!-- Нет фильтра для колонки "Активен" -->
                <th><input type="text" class="form-control filter-input" placeholder="Тип" data-field="type"></th>
                <th><input type="text" class="form-control filter-input" placeholder="Решение" data-field="decision"></th>
            </tr>
        </thead>

        <tbody>
            {% for product in products %}
            <tr>
                <td data-field="lotNumber">
                    <h5>
                        <strong>{{ product.lotNumber }}</strong>
                    </h5>
                </br>{{ product.mileage_count }}
                    <!-- <a href="{{ product.detailsUrl }}" target="_blank">{{ product.lotNumber }}</a> -->
                </td>
                <td data-field="model">
                    <a href="#" class="lot-link" data-lot-id="{{ product.lotId }}">{{ product.model }}</a>
                </td>
                <td data-field="name">{{ product.name }}</td>
                <td>
                    <a href="#" class="lot-link" data-lot-id="{{ product.lotId }}">
                        <img src="{{ product.mainImgUrl }}" style="width: 250px;">
                    </a>
                </td>
                <td data-field="mileage">
                    <a href="#" class="mileage-link" data-lot-id="{{ product.mileage }}">{{ product.mileage }}</a>
                    <!-- {{ product.mileage_count }} -->
                </td>
                <td data-field="energy">{{ product.energy }}</td>
                <td data-field="gearbox">{{ product.gearbox }}</td>
                <td>{{ 'Да' if product.isActive else 'Нет' }} {{ product.openingBid}} {{ product.highestBidValue}}</td>
                <td data-field="type">{{ product.type }}</td>
                <!-- <td data-field="decision">{{ product.decision }}</td> -->
                <td data-field="decision">
                    <!-- {{ product.decision }}
                    <svg class="bi" role="img" aria-label="Tools">
                        <use xlink:href="bootstrap-icons.svg#tools"/>
                    </svg>
                    <img src="/assets/icons/bootstrap.svg" alt="Bootstrap">
                    <svg class="bi bi-exclamation-triangle text-success" width="32" height="32" fill="currentColor" 
                            viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">                        
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" 
                        class="bi bi-emoji-heart-eyes" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="M11.315 10.014a.5.5 0 0 1 .548.736A4.498 4.498 0 0 1 7.965 13a4.498 4.498 0 0 1-3.898-2.25.5.5 0 0 1 .548-.736h.005l.017.005.067.015.252.055c.215.046.515.108.857.169.693.124 1.522.242 2.152.242.63 0 1.46-.118 2.152-.242a26.58 26.58 0 0 0 1.109-.224l.067-.015.017-.004.005-.002zM4.756 4.566c.763-1.424 4.02-.12.952 3.434-4.496-1.596-2.35-4.298-.952-3.434zm6.488 0c1.398-.864 3.544 1.838-.952 3.434-3.067-3.554.19-4.858.952-3.434z"/>
                    </svg>
                    <svg class="bi" width="32" height="32" fill="currentColor">
                        <use xlink:href="bootstrap-icons.svg#heart-fill"/>
                      </svg>
                      <svg class="bi" width="32" height="32" fill="currentColor">
                        <use xlink:href="bootstrap-icons.svg#toggles"/>
                      </svg>
                      <svg class="bi" width="32" height="32" fill="currentColor">
                        <use xlink:href="bootstrap-icons.svg#shop"/>
                      </svg>
                    -- -->
                    {% if product.decision == 'DECISION_REMOVED' %}
                        <i class="fas fa-times-circle text-danger" title="Удалено"></i>
                        <!-- <i class="bi check-square text-danger" title="Удалено"></i> -->
                    {% elif product.decision == 'DECISION_SOLD' %}
                        <i class="fas fa-check-circle text-success" title="Продано"></i>
                        <!-- <i class="bi bi-check-circle-fill text-success" title="Продано"></i> -->

                    {% else %}
                        <!-- <i class="bi bi-question-circle-fill text-warning" title="Неизвестно"></i> -->
                        <i class="fas fa-question-circle text-warning" title="Неизвестно"></i>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>

        
        <!-- <tbody>
            {% for product in products %}
            <tr>
                <td data-field="model">{{ product.model }}</td>
                <td data-field="name">{{ product.name }}</td>
                <td><img src="{{ product.mainImgUrl }}" style="width: 150px;"></td>
                <td data-field="energy">{{ product.energy }}</td>
                <td data-field="gearbox">{{ product.gearbox }}</td>
                <td>{{ 'Да' if product.isActive else 'Нет' }}</td>
                <td data-field="type">{{ product.type }}</td>
                <td data-field="decision">{{ product.decision }}</td>
            </tr>
            {% endfor %}
        </tbody> -->
    </table>

</div>

<!-- Модальное окно -->
<div class="modal fade" id="lotModal" tabindex="-1" role="dialog" aria-labelledby="lotModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="lotModalLabel">Информация о лоте</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="modalBodyContent">
                <!-- Здесь будет отображена информация о лоте -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</div>


<script>

    document.addEventListener("DOMContentLoaded", () => {
         
        // Обработчик кликов по пробегу
        const mileageLinks = document.querySelectorAll(".mileage-link");
        mileageLinks.forEach(link => {
            link.addEventListener("click", (event) => {
                event.preventDefault();
                const mileage = link.getAttribute("data-lot-id");
                // Перенаправляем на новую страницу с результатами поиска
                window.location.href = `/search-sales/${mileage}`;
            });
        });

        // **********************************************************************
        
        // Сохраняем изначальные карточки
        const originalCards = Array.from(document.querySelectorAll('.card'));
        const cardContainer = document.querySelector('.card-container');
        const cardCount = document.getElementById('card-count'); // Элемент для отображения количества карточек

        // Функция для обновления отображения карточек и подсчета
        function updateCardCount(visibleCards) {
            cardCount.textContent = `Всего: ${visibleCards}`;
        }

        // Устанавливаем изначальное количество карточек
        updateCardCount(originalCards.length);


        // Функция для применения фильтров
        function applyFilters() {
            // Получаем значения фильтров
            const nameFilter = document.getElementById('name').value.toLowerCase();
            const mileageFilter = parseInt(document.getElementById('mileage').value);
            const priceFilter = parseInt(document.getElementById('price').value);
            const modelFilter = document.getElementById('model').value.toLowerCase();
            const energyFilter = document.getElementById('energy').value.toLowerCase();
            const gearboxFilter = document.getElementById('gearbox').value.toLowerCase();
            const typeFilter = document.getElementById('type').value.toLowerCase();
            const mileageCountChecked = document.getElementById('mileage_count').checked;

            // Очищаем контейнер
            cardContainer.innerHTML = '';
            let visibleCount = 0; // Счетчик видимых карточек

            originalCards.forEach(card => {
                // Получаем значения из атрибутов data-*
                const cardName = card.dataset.name ? card.dataset.name.toLowerCase() : '';
                const cardMileage = card.dataset.mileage ? parseInt(card.dataset.mileage) : null;
                const cardPrice = card.dataset.openingbid ? parseInt(card.dataset.openingbid) : null;
                const cardModel = card.dataset.model ? card.dataset.model.toLowerCase() : '';
                const cardEnergy = card.dataset.energy ? card.dataset.energy.toLowerCase() : '';
                const cardGearbox = card.dataset.gearbox ? card.dataset.gearbox.toLowerCase() : '';
                const cardType = card.dataset.type ? card.dataset.type.toLowerCase() : '';
                const cardMileageCount = card.dataset.mileage_count ? parseInt(card.dataset.mileage_count) : 0;

                let isVisible = true;

                // Фильтры
                if (nameFilter && !cardName.includes(nameFilter)) isVisible = false;
                if (mileageFilter && cardMileage && cardMileage > mileageFilter) isVisible = false;
                if (priceFilter && cardPrice && cardPrice > priceFilter) isVisible = false;
                if (modelFilter && !cardModel.includes(modelFilter)) isVisible = false;
                if (energyFilter && !cardEnergy.includes(energyFilter)) isVisible = false;
                if (gearboxFilter && !cardGearbox.includes(gearboxFilter)) isVisible = false;
                if (typeFilter && !cardType.includes(typeFilter)) isVisible = false;
                if (mileageCountChecked && cardMileageCount <= 0) isVisible = false; // Фильтр по mileage_count

                // Добавляем карточку, если она видима
                if (isVisible) {
                    const colDiv = document.createElement('div');
                    colDiv.className = card.parentElement.className; // Используем класс родителя карточки
                    colDiv.appendChild(card);
                    cardContainer.appendChild(colDiv);
                    visibleCount++; // Увеличиваем счетчик видимых карточек
                }            
            });

            // Обновляем отображение количества карточек
            // cardCount.textContent = `Всего карточек: ${visibleCount}`;
            updateCardCount(visibleCount);            

        }


        // Привязываем событие `input` ко всем полям формы
        document.querySelectorAll('#filter-form input').forEach(input => {
            input.addEventListener('input', applyFilters);
        });
        
        
        // Обработчик для кнопки "Сбросить"
        document.querySelector('#filter-form button[type="reset"]').addEventListener('click', function () {
            // Очищаем контейнер
            cardContainer.innerHTML = '';
            // Восстанавливаем все исходные карточки
            originalCards.forEach(card => {
                const colDiv = document.createElement('div');
                colDiv.className = card.parentElement.className; // Используем класс родителя карточки
                colDiv.appendChild(card);
                cardContainer.appendChild(colDiv);
            });

            // Обновляем отображение количества карточек
            updateCardCount(originalCards.length);
        });

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function () {
            // Устанавливаем изначальное количество карточек
            updateCardCount(originalCards.length); 
        });

        // **********************************************************************
        
        const lotLinks = document.querySelectorAll(".lot-link");
        lotLinks.forEach(link => {
            link.addEventListener("click", async (event) => {
                event.preventDefault();
                const lotId = link.getAttribute("data-lot-id");
                // console.log(lotId);

                // AJAX-запрос для получения данных о лоте
                const response = await fetch(`/lot-details/${lotId}`);
                const lotData = await response.json();
                console.log(lotData);

                // Формируем контент для модального окна
                const modalContent = `
                    <div class="container-fluid">
                        <h5 class="text-center mb-3">Детали лота</h5>

                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-striped table-hover">
                                    <tbody>
                                        <tr>
                                            <th>Лот</th>
                                            <td><a href="${lotData.detailsUrl}" target="_blank">${lotData.lotNumber}</a></td>
                                        </tr>
                                        <tr>
                                            <th>Название</th>
                                            <td>${lotData.name}</td>
                                        </tr>
                                        <tr>
                                            <th>Модель</th>
                                            <td>${lotData.model}</td>
                                        </tr>
                                        <tr>
                                            <th>Топливо</th>
                                            <td>${lotData.energy}</td>
                                        </tr>
                                        <tr>
                                            <th>Пробег</th>
                                            <td>${lotData.mileage}</td>
                                        </tr>
                                        <tr>
                                            <th>Год выпуска</th>
                                            <td>${lotData.rollout}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="col-md-6">
                                <table class="table table-striped table-hover">
                                    <tbody>
                                        <tr>
                                            <th>Начальная ставка</th>
                                            <td>${lotData.openingBid} €</td>
                                        </tr>
                                        <tr>
                                            <th>Конечная ставка</th>
                                            <td>${lotData.highestBidValue} €</td>
                                        </tr>
                                        <tr>
                                            <th>Решение</th>
                                            <td>${lotData.decision}</td>
                                        </tr>
                                        <tr>
                                            <th>Тип</th>
                                            <td>${lotData.type}</td>
                                        </tr>
                                        <tr>
                                            <th>Коробка передач</th>
                                            <td>${lotData.gearbox}</td>
                                        </tr>                                        
                                        <tr>
                                            <th>Повторный раунд</th>
                                            <td>${lotData.extraRound ? 'Да' : 'Нет'}</td>
                                        </tr>
                                        <tr>
                                            <th>Активный</th>
                                            <td>${lotData.isActive ? 'Да' : 'Нет'}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Изображение -->
                        <div class="row mt-3">
                            <div class="col-12 text-center">
                                <img src="${lotData.mainImgUrl}" class="img-fluid rounded shadow-sm" alt="Фото лота" style="max-height: 700px;">
                            </div>
                        </div>
                    </div>
                    `;


                // Отображаем данные в модальном окне
                document.getElementById("modalBodyContent").innerHTML = modalContent;
                
                $('#lotModal').modal('show');

                // const modal = document.getElementById('lotModal');
                // const modalInstance = new bootstrap.Modal(modal);
                // modalInstance.show();
            });
        });
   
        // **********************************************************************        

        const filterInputs = document.querySelectorAll(".filter-input");
        const resetButton = document.getElementById("reset-filters");
        const lotCountSpan = document.getElementById("lot-count");

        // Функция для обновления счётчика лотов
        const updateLotCount = () => {
            const rows = document.querySelectorAll("tbody tr");
            const visibleRows = Array.from(rows).filter(row => row.style.display !== "none");
            lotCountSpan.textContent = visibleRows.length;
        };        

        const filterRows = () => {
            const filterValues = {};

            filterInputs.forEach(input => {
                const field = input.getAttribute("data-field");
                const value = input.value.toLowerCase();
                if (value) filterValues[field] = value;
            });

            const rows = document.querySelectorAll("tbody tr");

            rows.forEach(row => {
                let isMatch = true;

                for (const [field, filterValue] of Object.entries(filterValues)) {
                    const cell = row.querySelector(`td[data-field="${field}"]`);
                    const cellText = cell?.textContent.toLowerCase() || "";

                    if (!cellText.includes(filterValue)) {
                        isMatch = false;
                        break;
                    }
                }

                row.style.display = isMatch ? "" : "none";
            });

            // Обновляем количество лотов после фильтрации
            updateLotCount();
        };

        // Обработчики событий для фильтров
        filterInputs.forEach(input => {
            input.addEventListener("input", filterRows);
        });

        // // Добавляем кнопку сброса фильтров
        // const resetButton = document.createElement("button");
        // resetButton.textContent = "Сбросить фильтры";
        // resetButton.className = "btn btn-secondary mt-2";
        // document.querySelector("table").before(resetButton);

        resetButton.addEventListener("click", () => {
            filterInputs.forEach(input => {
                input.value = "";
            });
            filterRows();
        });

        // Инициализируем счётчик лотов при загрузке страницы
        updateLotCount();

        // **********************************************************************        



    });


    // document.addEventListener("DOMContentLoaded", () => {
    //     const filterInputs = document.querySelectorAll(".filter-input");
    //     const resetButton = document.getElementById("reset-filters");

    //     // Функция фильтрации строк
    //     const filterRows = () => {
    //         const filterValues = {};

    //         filterInputs.forEach(input => {
    //             const field = input.getAttribute("data-field");
    //             const value = input.value.toLowerCase();
    //             if (value) filterValues[field] = value;
    //         });

    //         const rows = document.querySelectorAll("tbody tr");

    //         rows.forEach(row => {
    //             const cells = Array.from(row.querySelectorAll("td"));
    //             let isMatch = true;

    //             for (const [field, filterValue] of Object.entries(filterValues)) {
    //                 const cell = row.querySelector(`td[data-field="${field}"]`);
    //                 const cellText = cell?.textContent.toLowerCase() || "";

    //                 if (!cellText.includes(filterValue)) {
    //                     isMatch = false;
    //                     break;
    //                 }
    //             }

    //             row.style.display = isMatch ? "" : "none";
    //         });
    //     };

    //     // Добавляем обработчик событий для фильтров
    //     filterInputs.forEach(input => {
    //         input.addEventListener("input", filterRows);
    //     });

    //     // Добавляем обработчик событий для кнопки сброса
    //     resetButton.addEventListener("click", () => {
    //         filterInputs.forEach(input => {
    //             input.value = ""; // Очищаем все поля фильтров
    //         });
    //         filterRows(); // Обновляем таблицу, показываем все строки
    //     });
    // });


    // document.addEventListener("DOMContentLoaded", () => {
    //     const filterInputs = document.querySelectorAll(".filter-input");

    //     filterInputs.forEach(input => {
    //         input.addEventListener("input", () => {
    //             const filterValues = {};
                
    //             // Собираем значения фильтров по их полям
    //             filterInputs.forEach(input => {
    //                 const field = input.getAttribute("data-field");
    //                 const value = input.value.toLowerCase();
    //                 if (value) filterValues[field] = value;
    //             });

    //             const rows = document.querySelectorAll("tbody tr");

    //             rows.forEach(row => {
    //                 const cells = Array.from(row.querySelectorAll("td"));
    //                 let isMatch = true;

    //                 // Проверяем каждое значение фильтра
    //                 for (const [field, filterValue] of Object.entries(filterValues)) {
    //                     // Ищем ячейку таблицы с атрибутом data-field, совпадающим с полем фильтра
    //                     const cell = row.querySelector(`td[data-field="${field}"]`);
    //                     const cellText = cell?.textContent.toLowerCase() || "";

    //                     if (!cellText.includes(filterValue)) {
    //                         isMatch = false;
    //                         break;
    //                     }
    //                 }

    //                 row.style.display = isMatch ? "" : "none";
    //             });
    //         });
    //     });
    // });


    // document.addEventListener("DOMContentLoaded", () => {
    //     const filterInputs = document.querySelectorAll(".filter-input");

    //     const filterToColumnMap = [0, 1, 3, 4, 6, 7];

    //     filterInputs.forEach(input => {
    //         input.addEventListener("input", () => {
    //             const filterValues = Array.from(filterInputs).map(input => input.value.toLowerCase());
    //             const rows = document.querySelectorAll("tbody tr");

    //             rows.forEach(row => {
    //                 const cells = Array.from(row.querySelectorAll("td"));

    //                 // Проверяем каждую ячейку, соответствующую фильтру
    //                 const match = filterValues.every((filterValue, index) => {
    //                     if (filterValue === "") return true; // Если фильтр пустой, пропускаем
    //                     const columnIndex = filterToColumnMap[index];
    //                     const cellText = cells[columnIndex]?.textContent.toLowerCase() || "";
    //                     // const cellText = cells[index]?.textContent.toLowerCase() || "";
    //                     return cellText.includes(filterValue);
    //                 });

    //                 row.style.display = match ? "" : "none";
    //             });
    //         });
    //     });
    // });


    // document.addEventListener("DOMContentLoaded", () => {
    //     console.log("JavaScript загружен"); // Добавьте эту строку
    //     const filterInputs = document.querySelectorAll(".filter-input");

    //     if (filterInputs.length === 0) {
    //         console.error("Фильтры не найдены");
    //     }




    //     filterInputs.forEach(input => {
    //         input.addEventListener("input", () => {
    //             console.log("Фильтрация запущена"); // Проверка события input
    //             const filterValues = Array.from(filterInputs).map(input => input.value.toLowerCase());
    //             console.log("Значения фильтров:", filterValues);

    //             const rows = document.querySelectorAll("tbody tr");

    //             rows.forEach(row => {
    //                 const cells = Array.from(row.querySelectorAll("td"));
    //                 const nameCell = cells[1]?.textContent.toLowerCase() || ""; // Вторая ячейка — это "название"
    //                 const filterValue = filterValues[1]; // Значение фильтра "название"
                    
    //                 const match = filterValue === "" || nameCell.includes(filterValue);
    //                 console.log(`Ячейка: ${nameCell}, Фильтр: ${filterValue}, Соответствует: ${match}`);
                    
    //                 row.style.display = match ? "" : "none";
    //             });


    //             // rows.forEach(row => {
    //             //     const cells = Array.from(row.querySelectorAll("td"));
    //             //     const match = cells.every((cell, index) => {
    //             //         const cellText = cell.textContent.toLowerCase();
    //             //         const filterValue = filterValues[index];
    //             //         console.log(`Ячейка: ${cellText}, Фильтр: ${filterValue}`);
    //             //         return filterValue === "" || cellText.includes(filterValue);
    //             //     });
    //             //     console.log(`Строка соответствует фильтру: ${match}`);
    //             //     row.style.display = match ? "" : "none";
    //             // });


    //             // rows.forEach(row => {
    //             //     const cells = Array.from(row.querySelectorAll("td"));
    //             //     const match = cells.some((cell, index) => {
    //             //         return filterValues[index] === "" || cell.textContent.toLowerCase().includes(filterValues[index]);
    //             //     });
    //             //     row.style.display = match ? "" : "none";
    //             // });
    //         });
    //     });
    // });
</script>
    
</body>
</html>
